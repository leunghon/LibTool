{%  extends 'main.html' %}

{% block content %}
<style>
	/* @font-face 
	{
    font-family: myFirstFont;
    src: url(ArianaVioleta-dz2K.ttf);
	} */
	.btn-primary
	{
		background-color: #4b2e83 !important;
	}
	.btn-secondary
	{
		background-color: #85754d !important;
	}
	.pagination
	{
		--bs-pagination-active-bg: #4b2e83 !important;
	}
	.pagination>.active>a
	{
		background-color: #4b2e83 !important;
		color: white  !important;
	}
	a
	{
		color:  #4b2e83 !important;
	}
	.sorting
	{
		font-size: 15px;
		line-height: 15px;
		/* spac */
		color: #4b2e83 !important;
		opacity: 1 !important;
	}
</style>
<head>
	<meta charset="UTF-8">
	<!-- <link rel="stylesheet" href='/searchtool/templates/style/customstyle.css'> -->
	<link rel='stylesheet' href='https://cdnjs.cloudflare.com/ajax/libs/datatables/1.10.12/css/dataTables.bootstrap.min.css'>
	<link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet"/>
	<link href="https://fonts.googleapis.com/css?family=Roboto:300,300i,500" rel="stylesheet"/>
	<link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet"/>
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css">
</head>
<div class="col-lg-10" style="height: max-content;">
	<div class="row" id="basicSearch"  style="display:none;">
		<div class="col">
			<div class="card card-body">
				<form method="get">
					<div class="form-group">
						{{myFilter.form}}
					</div>					
					<button class="btn btn-primary" type="submit">
						Search
					</button>
					<a href="{% url 'search' %}" style="    padding: 10px;
					margin: 10px;
					background: #85754d;
					border-radius: 7px;
					color: white !important;">
						Clear Search
					</a>
				</form>
			</div>
			{% if Filters %}
				<div>
					<h4>Active Filters</h4>
					{% for k in Filters %}
						<button class="btn btn-primary">
							{{k}}{{Filters.k}}
						</button>
					{% endfor %}
				</div>
			{% endif %}
			<!-- <h3>{{Filters}}</h3> -->
		</div>
		<br>
	</div>
	<div class="row">
		<div class="col-md">
			<div class="card card-body" >
				<table class="table responsive" id="sort" cellspacing="0" width="100%">
					<thead>
						<tr>
							<th>Genre</th>
							<th>Author</th>
							<th>Author(Eng)</th>
							<th>Translation Title</th>
							<th>Korean Title</th>
							<th>Translator</th>
							<th>Source</th>
							<th>Publisher</th>
							<th style="display: none;">authorEnglish2</th>
							<th>WorldCat Search</th>
							<th>Year</th>
						</tr>
					</thead>
					<tbody>
						{% for record in records %}
						<tr>
							{% if record.genre == "nan" %}
							<td></td>
							{% else %}
							<td>{{record.genre}}</td>
							{% endif %}	

							{% if record.authorKorean == "nan" %}
							<td></td>
							{% else %}
							<td>{{record.authorKorean}}</td>
							{% endif %}			
							
							{% if record.authorEnglish == "nan" %}
							<td></td>
							{% else %}
							<td>{{record.authorEnglish}}</td>
							{% endif %}	

							{% if record.workTitle == "nan" %}
							<td></td>
							{% else %}
							<td>{{record.workTitle}}</td>
							{% endif %}	

							{% if record.workTitleKorean == "nan" %}
							<td></td>
							{% else %}
							<td>{{record.workTitleKorean}}</td>
							{% endif %}	

							{% if record.translator == "nan" %}
							<td></td>
							{% else %}
							<td>{{record.translator}}</td>
							{% endif %}

							{% if record.sourceTitle == "nan" %}
							<td></td>
							{% else %}
							<td>{{record.sourceTitle}}</td>
							{% endif %}

							{%if record.publisher == "nan" %}
							<td></td>
							{% else %}
							<td>{{record.publisher}}</td>
							{% endif %}	
							<td class="d-flex justify-content-center" style="border-bottom: 0px;">
								<a href="https://worldcat.org/search?q={{record.sourceTitle}}+{{record.publisher}}+{{record.year}}" target="_blank">
									<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-link-45deg" viewBox="0 0 16 16">
										<path d="M4.715 6.542 3.343 7.914a3 3 0 1 0 4.243 4.243l1.828-1.829A3 3 0 0 0 8.586 5.5L8 6.086a1.002 1.002 0 0 0-.154.199 2 2 0 0 1 .861 3.337L6.88 11.45a2 2 0 1 1-2.83-2.83l.793-.792a4.018 4.018 0 0 1-.128-1.287z"/>
										<path d="M6.586 4.672A3 3 0 0 0 7.414 9.5l.775-.776a2 2 0 0 1-.896-3.346L9.12 3.55a2 2 0 1 1 2.83 2.83l-.793.792c.112.42.155.855.128 1.287l1.372-1.372a3 3 0 1 0-4.243-4.243L6.586 4.672z"/>
									</svg>
								</a>
							</td>
							{%if record.year == "nan" %}
							<td></td>
							{% else %}
							<td>{{record.year}}</td>
							{% endif %}
							<td style="display: none;">{{record.authorEnglish2}}</td>
						</tr>
						{% endfor %}
					</tbody>
				</table>
			</div>
		</div>
		<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
		<script src="https://cdnjs.cloudflare.com/ajax/libs/datatables/1.10.12/js/jquery.dataTables.min.js"></script>
		<script src="https://cdnjs.cloudflare.com/ajax/libs/datatables/1.10.12/js/dataTables.bootstrap.min.js"></script>
		<script src='https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.18.0/moment.min.js'></script>
		<script  src="function.js"></script>
	</div>
</div>
<div class="col-lg-2">
	<div class="row">
		<button type="button" id="AdvSearch" class="btn btn-primary" onclick="showDiv()">Advanced Search</button>
		<div class="col">
			<h4>Authors Korean</h4>
			<div class="card card-body overflow-auto" style="height: 250px;">
				<ul>
					{% for krName in NamesKr %}
						<a class="row" href="{% url 'search' %}?authorKorean={{krName}}">{{krName}}</a>
					{% endfor %}
				</ul>
			</div>
			<h4>Authors English</h4>
			<div class="card card-body overflow-auto" style="height: 250px; margin-bottom: 15px;">
				<ul>
					{% for engName in NamesEng %}
						<a class="row" href="{% url 'search' %}?authorEnglish2={{engName}}">{{engName}}</a>
					{% endfor %}
				</ul>
			</div>
			<!-- Genre Filter -->
			<h4>Genre</h4>
				<div class="card card-body">
    				<select id="genre-select" name="genre">
        				{% for genre in Genres %}
            			<option value="{{ genre }}">{{ genre }}</option>
        				{% endfor %}
    				</select>
				</div>

			<!-- Year Filter -->
			<h4>Year</h4>
				<div class="card card-body">
					<input type="number" id="year-start" name="year_start" placeholder="Start Year">
					<input type="number" id="year-end" name="year_end" placeholder="End Year">
				</div>
			</div>
		<!-- Button -->
		<!-- <button class="btn btn-primary" >New Record</button> -->
		<button type="button" class="btn btn-primary" data-toggle="modal" data-target="#exampleModalCenter">
			New Record
		</button>		
		<div class="modal fade" id="exampleModalCenter" tabindex="-1" role="dialog" aria-labelledby="exampleModalCenterTitle" aria-hidden="true">
			<div class="modal-dialog modal-dialog-centered" role="document">
			<div class="modal-content">
				<div class="modal-header">
				<h5 class="modal-title" id="exampleModalLongTitle">New record request form</h5>
				<button type="button" class="close" data-dismiss="modal" aria-label="Close">
					<span aria-hidden="true">&times;</span>
				</button>
				</div>
				<div class="modal-body">
				Form to fill and request the new record will appear here soon!!
				</div>
				<div class="modal-footer">
				<button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
				<button type="button" class="btn btn-primary">Submit</button>
				</div>
			</div>
			</div>
		</div>
	</div>
</div>
<script>
	$(document).ready(function() {
		let inputUrl = new URL(window.location.href);
		let inputParams = new URLSearchParams(inputUrl.search);
		$("#sort").DataTable({
			"pageLength": 100,
			"lengthMenu": [ 50, 100, 200, 300, 400, 500 ],
		});
		document.getElementsByClassName("form-control").style="width:500px;background-color:#CBDCFF";
		document.getElementsByClassName("form-control-sm").style="width:500px;background-color:#CBDCFF";
		document.getElementsByClassName("form-control").placeholder="Search for any key word";
		document.getElementsByClassName("form-control-sm").placeholder="Search for any key word";
		$('#exampleModalCenter').on('shown.bs.modal', function () {
				$('#myInput').trigger('focus')
		})
		if(inputParams.has("authorEnglish2"))
		{
			console.log("Are we here?");
			document.getElementById('basicSearch').style.display = "block";
			document.getElementById('AdvSearch').className="btn btn-secondary";
			document.getElementById('AdvSearch').innerHTML="Search";
		}
		else
		{
			document.getElementById('basicSearch').style.display = "none";
			document.getElementById('AdvSearch').className="btn btn-primary";
			document.getElementById('AdvSearch').innerHTML="Advanced Search";
		}
	});
	function showDiv() {
		if(document.getElementById('basicSearch').style.display == "none")
		{
			document.getElementById('basicSearch').style.display = "block";
			document.getElementById('AdvSearch').className="btn btn-secondary";
			document.getElementById('AdvSearch').innerHTML="Search";
		}
		else
		{
			document.getElementById('basicSearch').style.display = "none";
			document.getElementById('AdvSearch').className="btn btn-primary";
			document.getElementById('AdvSearch').innerHTML="Advanced Search";
		}
	}
	function autoSubmitSearch() {
    var baseUrl = "{% url 'search' %}";
    var authorKorean = getSelectedValue('authorKorean'); // Assuming you have a function to get selected author
    var authorEnglish = getSelectedValue('authorEnglish2'); // Similarly for English author
    var genre = document.getElementById('genreSelect').value; // Get genre value
    var year = document.getElementById('yearInput').value; // Get year value

    var searchUrl = baseUrl + "?authorKorean=" + authorKorean + "&authorEnglish2=" + authorEnglish + "&genre=" + genre + "&year=" + year;
    window.location.href = searchUrl;
	}
</script>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.4/jquery.min.js"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/js/bootstrap.min.js"></script>
{% endblock %}